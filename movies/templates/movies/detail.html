{% extends 'base.html' %}
{% load bootstrap4 %}

{% block style %}
p {
  margin-bottom: 0;
}
a {
  color: white;
}
ul {
  padding-left: 0;
}
li {
  list-style: none;
}
button {
  background: none;
  border: none;
  outline: 0;
  color: white;
}
.container {
  max-width: 100vw;
  padding: 0;
}
.movie-header {
  width: 100vw;
  height: 500px;
  background-color: #3a3a41;
}
.header-top {
}
.header-top .header-backdrop {
  position: relative;
}
.movie-header .header-backdrop img {
  width: 100%;
  height: 300px;
  object-fit: cover;
}
.movie-header .header-top-item {
  width: 700px;
  margin: 0 auto;
  display: flex;
  position: relative;
  align-items: flex-end;
  justify-content: center;
  bottom: unset;
  gap: 20px;
}
.movie-header .header-top-info {
  margin-bottom: 10px;
}

.movie-poster {
  position: absolute;
  top: 0;
}
.movie-poster img {
  width: 130px;
}
.header-movie-info {
  max-width: 600px;
  margin: 10px auto;
  transform: translateX(80px);
}
.header-movie-info > div {
  border-bottom: 1px solid gray;
}
.header-tool {
  display: flex;
  align-items: center;
}


.movie-card {
  margin-top: 40px;
  max-width: 700px;
  background-color: #3a3a41;
  border: 1px solid #1f1f24;
  min-height: 500px;
  margin: 40px auto;
  border-radius: 7px;
  padding: 30px;
}
.movie-card hr {
  margin: 30px 0;
}
.movie-card .section-title {
  margin-bottom: 30px;
  display: flex;
  gap: 10px;
}
.movie-card .section-title h3 {
  font-size: 20px;
  font-weight: bold;
}
.movie-card .basic-info p {
  margin: 5px 0;
  font-size: 15px;
}

/* review-item */
.review-item {
  border-radius: 10px;
  height: 100%;
}
.item-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}
.user-info {
  display: flex;
  align-items: center;
  gap: 15px;
}
.user-info > img {
  width: 30px;
  border-radius: 50%;
  background-color: #fff;
}
.item-data {
  color: rgba(255, 175, 2, 0.719);
  font-size: 12px;
}
.item-content {
  margin-bottom: 10px;
  font-size: 14px;
  display: -webkit-box;
  -webkit-line-clamp: 6;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}
.spoiler-prevent {
  color: rgb(103, 103, 103);
  font-size: 12px;
}
.item-content.spoiler {
  filter: blur(5px);
}
.icon-box {
  display: flex;
  border-top: 1px solid rgb(46, 46, 46);
  position: absolute;
  left: 16px;
  bottom: 16px;
}
.icon-box button, .icon-box a {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 7px;
}
.icon-box button p, .icon-box a p {
  width: 20px;
  display: flex;
  margin-bottom: 0;
}


/* carousel */
.carousel {
  margin-top: -70px;
}
.carousel h2 {
  margin: 0;
}
.carousel .carousel__card {
  text-decoration: none;
  color: #fff;
  position: relative;
}

.carousel h3 {
  font-size: 16px;
  margin: 0;
  margin-bottom: 4px;
}
.carousel span {
  color: #a7a7a7;
  font-size: 14px;
}
.carousel .dragging .carousel__card {
  pointer-events: none;
}
.carousel .carousel__wrapper {
  position: relative;
  margin-bottom: 24px;
}
@media only screen and (min-width: 1180px) {
  .carousel .carousel__wrapper.has-arrows .carousel__content {
    justify-content: start;
  }
}
@media only screen and (min-width: 1180px) {
  .carousel .carousel__wrapper.has-arrows .carousel__arrows {
    display: flex;
  }
}
.carousel .carousel__content {
  justify-content: start;
  overflow-y: hidden;
  overflow-x: scroll;
  scrollbar-width: none;
  -ms-overflow-style: none;
  display: grid;
  -webkit-overflow-scrolling: touch;
  cursor: grab;
  padding: 0;
  margin: 0;
  grid-gap: 24px;
  grid-auto-flow: column;
  list-style: none;
}
.carousel .carousel__content::-webkit-scrollbar {
  display: none;
}
.carousel .carousel__item .carousel__card {
  width: 330px;
  height: 330px;
  display: flex;
  justify-content: center;
  justify-content: flex-start;
  align-items: center;
  flex-direction: column;
  position: relative;
  user-select: none;
  margin: 10px 0px;
  padding: 24px;
  background-color: rgb(36, 35, 34);
  border-radius: clamp(0px, ((100vw - 4px) - 100%) * 9999, 8px);
  cursor: pointer;
}
.carousel .carousel__controls {
  position: relative;
  top: 170px;
  left: -15px;
  width: 105%;
  display: flex;
  justify-content: space-between;
  z-index: 4;
}
.carousel .carousel__arrow {
  padding: 0;
  background: transparent;
  box-shadow: none;
  border: 0;
  padding: 18px 16px;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.728);
}
.carousel .carousel__arrow:before {
  content: "";
  background: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNSIgaGVpZ2h0PSI5IiB2aWV3Qm94PSIwIDAgMTUgOSI+Cgk8cGF0aCBmaWxsPSIjMzMzMzMzIiBkPSJNNy44NjcgOC41NzRsLTcuMjItNy4yMi43MDctLjcwOEw3Ljg2NyA3LjE2IDE0LjA1Ljk4bC43MDYuNzA3Ii8+Cjwvc3ZnPgo=");
  background-size: contain;
  filter: brightness(2);
  display: block;
  width: 18px;
  height: 12px;
  cursor: pointer;
}
.carousel .carousel__arrow.arrow-prev:before {
  transform: rotate(90deg);
}
.carousel .carousel__arrow.arrow-next:before {
  transform: rotate(-90deg);
}
.carousel .carousel__arrow.disabled::before {
  background: transparent;
}
.carousel .carousel__arrow.disabled {
  background: transparent;
}
{% endblock style %}

{% block content %}
{% comment %} <div style="height: 100px;"></div> {% endcomment %}
{% comment %} <h1>{{resdatas.title}}</h1>
<br>
{{resdatas.vote_average}}
<br>
<img src="https://www.themoviedb.org/t/p/w300_and_h450_bestv2/{{resdatas.poster_path}}" alt="영화 포스터">
<hr>
{{resdatas.overview}} {% endcomment %}

<div class="movie-header">
  <div class="header-top">
    <div class="header-backdrop">
      <img src="https://image.tmdb.org/t/p/w780/tmU7GeKVybMWFButWEGl2M4GeiP.jpg" alt="">
      <div class="header-top-item">
        {% comment %} <div class="movie-poster">
          <img src="https://www.themoviedb.org/t/p/w300_and_h450_bestv2/{{resdatas.poster_path}}" alt="영화 포스터">
        </div> {% endcomment %}
        <div class="header-top-info">
          <span>개봉일 <b>2023.05.12</b></span>
          <span>누적관객 <b>1000만명</b></span>
        </div>
      </div>
    </div>

  </div>
  <div class="header-movie-info">
    <h1 class="movie-title">{{resdatas.title}}</h1>
    <div class="movie-detail-info">
      2023 ・ 액션/모험/코미디 ・ 미국
    </div>
    <div class="movie-vote-average">
      평균 ★4.1 (4만명)
    </div>
    <div class="header-tool">
      <div class="review-container">
        <div class="review-text">
          평가하기
        </div>
        <div class="stars" style="display:none;">
          <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#eee" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#eee" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#eee" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#eee" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#eee" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg>
          <div class="stars-checked">
            <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#ffdd63" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#ffdd63" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#ffdd63" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#ffdd63" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewbox="0 0 44 44" fill="#ffdd63" class="css-fnwbjg"><g fill-rule="evenodd"><path d="M22 33.444L9.83 42.327c-.784.572-1.842-.196-1.539-1.118l4.687-14.32L.769 18.06c-.787-.569-.383-1.812.588-1.81l15.067.033 4.624-14.34c.298-.924 1.606-.924 1.904 0l4.624 14.34 15.067-.033c.971-.002 1.375 1.241.588 1.81l-12.209 8.829 4.688 14.32c.302.922-.756 1.69-1.54 1.118L22 33.444z"></path></g></svg>
          </div>
        </div>
      </div>
      <div class="header-icon-box">
        <button class="header-icon">
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" class="injected-svg" data-src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIwLjUgMTMuMDkyOUgxMy4xNDI4VjIwLjVIMTAuODU3MVYxMy4wOTI5SDMuNVYxMC44MDcxSDEwLjg1NzFWMy41SDEzLjE0MjhWMTAuODA3MUgyMC41VjEzLjA5MjlaIiBmaWxsPSJjdXJyZW50Q29sb3IiLz4KPC9zdmc+Cg==" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M20.5 13.0929H13.1428V20.5H10.8571V13.0929H3.5V10.8071H10.8571V3.5H13.1428V10.8071H20.5V13.0929Z" fill="currentColor"></path>
            </svg>
          </div>
          보고싶어요
        </button>
        <button class="header-icon">
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" class="injected-svg" data-src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTMgMTcuMjUyNVYyMS4wMDI1SDYuNzVMMTcuODEgOS45NDI1TDE0LjA2IDYuMTkyNUwzIDE3LjI1MjVaTTIwLjcxIDcuMDQyNUMyMS4xIDYuNjUyNSAyMS4xIDYuMDIyNSAyMC43MSA1LjYzMjVMMTguMzcgMy4yOTI1QzE3Ljk4IDIuOTAyNSAxNy4zNSAyLjkwMjUgMTYuOTYgMy4yOTI1TDE1LjEzIDUuMTIyNUwxOC44OCA4Ljg3MjVMMjAuNzEgNy4wNDI1WiIgZmlsbD0iY3VycmVudENvbG9yIi8+Cjwvc3ZnPgo=" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M3 17.2525V21.0025H6.75L17.81 9.9425L14.06 6.1925L3 17.2525ZM20.71 7.0425C21.1 6.6525 21.1 6.0225 20.71 5.6325L18.37 3.2925C17.98 2.9025 17.35 2.9025 16.96 3.2925L15.13 5.1225L18.88 8.8725L20.71 7.0425Z" fill="currentColor"></path>
            </svg>
          </div>
          코멘트
        </button>
        <button class="header-icon">
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" class="injected-svg" data-src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDVDNyA1IDIuNzMgOC4xMSAxIDEyLjVDMi43MyAxNi44OSA3IDIwIDEyIDIwQzE3IDIwIDIxLjI3IDE2Ljg5IDIzIDEyLjVDMjEuMjcgOC4xMSAxNyA1IDEyIDVaTTEyIDE3LjVDOS4yNCAxNy41IDcgMTUuMjYgNyAxMi41QzcgOS43NCA5LjI0IDcuNSAxMiA3LjVDMTQuNzYgNy41IDE3IDkuNzQgMTcgMTIuNUMxNyAxNS4yNiAxNC43NiAxNy41IDEyIDE3LjVaTTEyIDkuNUMxMC4zNCA5LjUgOSAxMC44NCA5IDEyLjVDOSAxNC4xNiAxMC4zNCAxNS41IDEyIDE1LjVDMTMuNjYgMTUuNSAxNSAxNC4xNiAxNSAxMi41QzE1IDEwLjg0IDEzLjY2IDkuNSAxMiA5LjVaIiBmaWxsPSJjdXJyZW50Q29sb3IiLz4KPC9zdmc+Cg==" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M12 5C7 5 2.73 8.11 1 12.5C2.73 16.89 7 20 12 20C17 20 21.27 16.89 23 12.5C21.27 8.11 17 5 12 5ZM12 17.5C9.24 17.5 7 15.26 7 12.5C7 9.74 9.24 7.5 12 7.5C14.76 7.5 17 9.74 17 12.5C17 15.26 14.76 17.5 12 17.5ZM12 9.5C10.34 9.5 9 10.84 9 12.5C9 14.16 10.34 15.5 12 15.5C13.66 15.5 15 14.16 15 12.5C15 10.84 13.66 9.5 12 9.5Z" fill="currentColor"></path>
            </svg>
          </div>
          보는중
        </button>
      </div>
    </div>
  </div>
</div>

<div class="movie-card">
  <div class="basic-info">
    <div class="section-title">
      <h3>기본 정보</h3>
    </div>
    <div class="info-desc">
      <p>원제</p>
      <p>2023 · 미국 · 액션</p>
      <p>러닝 타임 · 15세</p>
      <p>{{resdatas.overview}}</p>
    </div>
  </div>
  <hr>
  <div class="movie-review">
    <div class="section-title">
      <h3>리뷰</h3>
      {% if reviews %}
        <p>{{ reviews|length }}개</p>
      {% endif %}
    </div>
    <div class="review-container">
      <div class="carousel">
        {% comment %} 포토카드 {% endcomment %}
        <div class="carousel__wrapper">
          {% if reviews|length > 1 %}
          <div class="carousel__controls">
            <button class="carousel__arrow disabled arrow-prev"></button>
            <button class="carousel__arrow arrow-next"></button>
          </div>
          {% else %}
          <div style="height:60px;">-</div>
          {% endif %}
          
          <ul class="carousel__content">
            {% for review in reviews %}
              <li class="carousel__item">
                <div class="carousel__card">
                  <div class="review-item">
                    <div class="item-header">
                      <a class="user-info" href="{% url 'accounts:profile' review.user.email %}">
                        <img src="{{review.user.profile_image.url}}" alt="{{review.user.nickname}}">
                        <p>{{ review.user.nickname }}</p>
                      </a>
                      <p class="item-data">{{ review.created_at }}</p>
                    </div>
                    {% if review.spoiler %}
                    <a href="{% url 'reviews:detail' review.pk %}" class="spoiler-link">
                      <div class="spoiler-prevent">
                        *스포일러가 포함된 리뷰입니다. 확인하려면 클릭해주세요.
                      </div>
                      <div class="item-content spoiler">
                        {{ review.content }}
                      </div>
                    </a>
                    {% else %}
                    <a href="{% url 'reviews:detail' review.pk %}">
                      <div class="item-content">
                        {{ review.content }}
                      </div>
                    </a>
                    {% endif %}
                    <div class="icon-box">
                      <form action="#" class="review-like-form" data-review-id="{{ review.pk }}">
                        {% csrf_token %}
                        <button class="like" id="like-{{ review.pk }}"  {% if not user.is_authenticated or user == review.user %}disabled{% endif %}>
                          {% if request.user in review.like_users.all %}
                            <p class="icon"><svg viewBox="0 0 24 24" fill="#ff4d4d" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="Interface / Heart_01"> <path id="Vector" d="M12 7.69431C10 2.99988 3 3.49988 3 9.49991C3 15.4999 12 20.5001 12 20.5001C12 20.5001 21 15.4999 21 9.49991C21 3.49988 14 2.99988 12 7.69431Z" stroke="#ff4d4d" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path> </g> </g></svg></p>
                          {% else %}
                            <p class="icon"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="Interface / Heart_01"> <path id="Vector" d="M12 7.69431C10 2.99988 3 3.49988 3 9.49991C3 15.4999 12 20.5001 12 20.5001C12 20.5001 21 15.4999 21 9.49991C21 3.49988 14 2.99988 12 7.69431Z" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path> </g> </g></svg></p>
                          {% endif %}
                          <p class="review-like-count">{{ review.like_users.all|length}}</p>
                        </button>  
                      </form>   
                      <a class="comment" href="{% url 'reviews:detail' review.pk %}">
                        <p class="icon"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g clip-path="url(#clip0_429_11233)"> <path d="M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 13.4876 3.36093 14.891 4 16.1272L3 21L7.8728 20C9.10904 20.6391 10.5124 21 12 21Z" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path> </g> <defs> <clipPath id="clip0_429_11233"> <rect width="24" height="24" fill="white"></rect> </clipPath> </defs> </g></svg></p>
                        <p>{{ review.comment_set.all|length }}</p>
                      </a>
                    </div>
                  </div>
                </div>
              </li>
            {% endfor %}
          </ul>
          </div>
        </div>
    </div>
  </div>
</div>

<br>


{% comment %} {% for genre_id in resdatas.genre_ids %}
  {% for data in datas %}
    {% ifequal genre_id data.id %}
      {{data.name}}
    {% endifequal %}
  {% endfor %}
{% endfor %} {% endcomment %}

<br>
{% comment %} <a href="{% url 'movies:index' %}">뒤로가기</a> {% endcomment %}

{% endblock content %}

{% block script %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script type="module">
  const moviePk = location.href.split('/')[4]
  const options = {
    method: 'GET',
    url: `https://api.themoviedb.org/3/movie/${moviePk}?api_key=f0ee4eefc21a888bf1229e2d951df4e6&language=ko`,
    headers: {
      accept: 'application/json',
    }
  };
  axios
    .request(options)
    .then(function (response) {
      console.log(response.data.backdrop_path);
    })
    .catch(function (error) {
      console.error(error);
    });
</script>
<script>
  const forms = document.querySelectorAll('.like-forms');
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value

  forms.forEach((form) => {
    form.addEventListener('submit', function (event) {
      event.preventDefault()
      const reviewId = event.target.dataset.reviewId
      // headers: {'X-CSRFToken': csrftoken},
      axios({
        method: 'post',
        url: `http://127.0.0.1:8000/reviews/${reviewId}/likes/`,
        headers: {'X-CSRFToken': csrftoken},
      })
      .then((response) => {
        // like 버튼을 이전에 눌렀는가? 좋아요 / 좋아요 취소를 할지 결정 (서버로 좋아요 여부 받기)
        const isLiked = response.data.is_liked
        const likeBtn = document.querySelector(`#like-${reviewId}`)
        const likes=document.querySelector("#likes")
        if (isLiked === true) {
          likeBtn.value = '좋아요 취소'
          likes.textContent=Number(likes.textContent) + 1
        } else {
          likeBtn.value = '좋아요',
          likes.textContent=Number(likes.textContent) - 1
        }
      })
    })
  })

</script>
<script>
  window.addEventListener( 'load', () => {
    const COMPONENT_SELECTOR = '.carousel__wrapper';
    const CONTROLS_SELECTOR = '.carousel__controls';
    const CONTENT_SELECTOR = '.carousel__content';

    const components = document.querySelectorAll( COMPONENT_SELECTOR );

    for ( let i = 0; i < components.length; i++ ) {
      const component = components[ i ];
      const content = component.querySelector( CONTENT_SELECTOR );
      let x = 0;
      let mx = 0;
      const maxScrollWidth = content.scrollWidth - content.clientWidth / 2 - content.clientWidth / 2;
      const nextButton = component.querySelector( '.arrow-next' );
      const prevButton = component.querySelector( '.arrow-prev' );

      if ( maxScrollWidth !== 0 ) {
        component.classList.add( 'has-arrows' );
      }

      if ( nextButton ) {
        nextButton.addEventListener( 'click', function ( event ) {
          event.preventDefault();
          x = content.clientWidth / 2 + content.scrollLeft + 0;
          content.scroll( {
            left: x,
            behavior: 'smooth',
          } );
        } );
      }

      if ( prevButton ) {
        prevButton.addEventListener( 'click', function ( event ) {
          event.preventDefault();
          x = content.clientWidth / 2 - content.scrollLeft + 0;
          content.scroll( {
            left: -x,
            behavior: 'smooth',
          } );
        } );
      }

      /**
      * Mouse move handler.
      *
      * @param {object} e event object.
      */
      const mousemoveHandler = ( e ) => {
        const mx2 = e.pageX - content.offsetLeft;
        if ( mx ) {
          content.scrollLeft = content.sx + mx - mx2;
        }
      };

      /**
      * Mouse down handler.
      *
      * @param {object} e event object.
      */
      const mousedownHandler = ( e ) => {
        content.sx = content.scrollLeft;
        mx = e.pageX - content.offsetLeft;
        content.classList.add( 'dragging' );
      };

      /**
      * Scroll handler.
      */
      const scrollHandler = () => {
        toggleArrows();
      };

      /**
      * Toggle arrow handler.
      */
      const toggleArrows = () => {
        if ( content.scrollLeft > maxScrollWidth - 10 ) {
          nextButton.classList.add( 'disabled' );
        } else if ( content.scrollLeft < 10 ) {
          prevButton.classList.add( 'disabled' );
        } else {
          nextButton.classList.remove( 'disabled' );
          prevButton.classList.remove( 'disabled' );
        }
      };

      /**
      * Mouse up handler.
      */
      const mouseupHandler = () => {
        mx = 0;
        content.classList.remove( 'dragging' );
      };

      content.addEventListener( 'mousemove', mousemoveHandler );
      content.addEventListener( 'mousedown', mousedownHandler );
      if ( component.querySelector( CONTROLS_SELECTOR ) !== undefined ) {
        content.addEventListener( 'scroll', scrollHandler );
      }
      content.addEventListener( 'mouseup', mouseupHandler );
      content.addEventListener( 'mouseleave', mouseupHandler );
    }
  } );
</script>
{% endblock script %}